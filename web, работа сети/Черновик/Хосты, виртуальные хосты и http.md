Хочется от А до Я разобраться, что же все-таки происходит, когда мы вбиваем в адресную строку адрес и нажимаем ввод.



*Host* - интересный заголовок, с которым связана важная тема, поэтому я выделил его в отдельный раздел. Заголовок Host содержит адрес и (опционально) порт хоста, которому предназначен запрос. Вообще Http - это протокол прикладного уровня. Как следствие этого, когда отправляется Http-запрос, соединение уже установлено. Стало быть, хост и порт уже известны. Зачем же тогда такой заголовок? 

Чтобы это понять, нужно небольшое введение в устройство "сайтов". Терминология разнится от источника к источнику, поэтому сделаю свою терминологию с блэк-джеком и хостами. 

Для начала разберемся на примере самых простых сайтов, которые суть набор html-страниц и php-скриптов, а не условное спринг-веб-приложение, с которым (возможно) дела обстоят иначе.

Определимся с терминологией: "сервер" (или "хост") - реальный железный компьютер с IP адресом. На сервере работает "веб-сервер" - программа, "слушающая" определенный порт (обычно это порт 80 при использовании протокола Http и порт 443 для Https). Пример такой программы - веб-сервер Apache. При дальнейшем чтении важно различать эти понятия: если написано сервер (или хост) - значит подразумевается компьютер, если веб-сервер - программа.

Задача веб-сервера - принять http-запрос и по информации из него понять, какой именно сайт отдать, потому что на одном сервере обычно работает множество сайтов.

Чтобы на одном сервере можно было размещать несколько сайтов, у веб-сервера есть функционал "виртуальных хостов" (virtual host). Как конкретно он реализован - не важно. Например, под каждый сайт может быть отведена отдельная директория, и есть конфигурационный файл, в котором прописано, что "файлы сайта A лежат в директории dirA, а файлы сайта B - в директории dirB". Такая виртуализация называется name-based виртуализация, или "виртуализация на основе имен". Но суть не в том, как это называется и как еще это может быть реализовано, а в том, что в итоге один веб-сервер способен поддерживать несколько сайтов. И для пользователя "хост" и "виртуальный хост" понятия равнозначные, хотя технически виртуальный хост не является отдельным компьютером со своим IP-адресом.

В http-запросе информация о хосте может находиться непосредственно в url (тогда это называется абсолютным url). В этом случае заголовок Host игнорируется. Если же url не содержит хоста, тогда это url относительный и требуется заголовок Host, причем он должен быть только один, иначе обычно возвращается код 400 (Bad Request). Если порт не указан, то для Http используется порт 80 по умолчанию, а для Https - 403.

:question: И тут возникает вопрос: мы ведь в адресной строке указываем виртуальный хост, т.е. по сути этакое нечто, существующее непонятно где, в какой-то директории на каком-то компьютере, в маленьком локальном мирке веб-сервера. Как же оно отыскивается и передается нам?

Для начала нужно понять, как вообще устанавливается соединение по сети. В конспекте про сокеты я уже писал об этом, но напишу и здесь. Отчасти для повторения, а отчасти получится только нужное подмножество информации.

Соединение устанавливается не между компьютерами, а между программами, которые на этих компьютерах работают. Если программа работает с сетью, то ОС резервирует за этой программой некоторое целое число, называемое *порт*. И если какая-то программа A на компьютере K1 хочет обменяться данными с программой B на другом компьютере K2, то ей нужно две вещи: IP-адрес компьютера K2 и порт, закрепленный за программой B.

Тогда ОС с помощью пары протоколов TCP\IP (например) устанавливает соединение между программами (как именно - опять же, сейчас не особо важно, это детали и для них положена отдельная тема (сокеты)) и они уже могут обмениваться данными. В нашем случае эти программы - браузер (или иной *юзер-агент*, например, программа postman) и веб-сервер. А данные - это http-сообщения.

Ну так и как же браузеру узнать IP-адрес сервера по имени сайта "*lolkek.com*", если за ним кроется виртуальный хост?





На это накладываются реалии жизни в виде VPS, shrared-хостингов и т.д., и т.п. Но голая основа теперь примерно понятна.

