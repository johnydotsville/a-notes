PKI - Public Key Infrastructure
PKCS - Public Key Cryptography Standarts
CMS - Cryptographic Message Syntax

### Криптография и ключи

Криптография - симметричная и ассиметричная (с открытым и закрытым ключом соответственно)

В симметричной - шифрование и дешифрование происходит с помощью одинакового ключа. Польза пока сомнительна.

В ассиметричной - создается ключ, ~~который делится на две половины - A и B~~ (скорее всего, все-таки создается *пара* ключей, т.е две штуки, один из которых является приватным, а другой публичным. Выражение "один ключ делится на две половины" можно рассматривать разве что с концептуальной точки зрения, т.е. два "реальных" ключа вместе составляют один "логический"). Принцип в том, что сообщение, зашифрованное любой половиной, может быть расшифрованно *только* другой половиной. То есть, зашифровали через А - расшифровать можно только через В, и наоборот. Таким образом если одну половину оставить себе, то вторую можно спокойно отдать "во вне" и все, кому надо послать *нам* зашифрованное сообщение, смогут сделать это без боязни, что ее расшифрует кто-то кроме нас. Одна половина зовется private key (закрытый ключ), а вторая - public key (открытый ключ). Соответственно, мы информацию своим ключом ("закрытым") только дешифруем. Использовать его для шифровки - бессмысленно, потому что все смогут его расшировать открытым ключом.

### Криптохэш

Хэш \ криптохэш - это функция, которая гененирует значение фиксированного размера на основе данных любого размера. То есть например дали ей сначала один килобайт, а она вернула 128 бит. Потом дали ей 10 Гб, а она опять вернула 128 бит. Выход для одинаковых входных значений - одинаковый, а для разных входных значений - сильно отличается и не должен повторяться. Хотя повторы, теоретически, неизбежны, потому что например для 128 бит в лучшем случае возможно 2^128 разных комбинаций. Соответственно, если шифровать количество сообщений (2^128) + 1, то будет повтор. На практике повторов еще больше, но задача криптохэша - минимизировать их и сделать максимально сложным или невозможным подбор сообщений, у которых хэш бы совпал.

### Как это работает вместе - подпись

Если взять исходный текст письма, вычислить от него хэш-функцию, зашифровать результат своим закрытым ключом и отдать другу, у которого есть открытый ключ, тогда он сможет убедиться в правильности текста письма, если расшифрует подпись, получив таким образом наш хэш, потом сам вычислит хэш от текста письма и если эти хэши совпадут, значит письмо верное.

Подлог можно сделать двумя способами - либо подобрать такой текст для поддельного письма, чтобы его хэш был такой же, как у оригинального письма, либо к поддельному письму и приложить заодно и поддельный хэш. Первое маловероятно, потому что криптохэши имеют хорошую надежность и подобрать два разных входных значения, чтобы при этом был одинаковый хэш - сложно. Для второго - необходимо иметь закрытый ключ, с помощью которого можно было бы зашифровать поддельный хэш, но это уже вопрос административный - закрытый ключ должен надежно храниться и не попадать в третьи руки.

### А проблемы?

Есть и проблемы - пользователь A для защищенного обмена как-то должен передать своему партнеру B открытый ключ. Но поскольку канал передачи еще не защищен, злоумышленник Z может перехватить открытый ключ от А. Затем Z генерирует свою пару ключей, отсылает B свой открытый ключ и работает по следующей схеме: получает оригинальные сообщения от А, дешифрует их украденным открытым ключом. Меняет содержимое, шифрует своим закрытым ключом и пересылает В. Тот дешифрует их подложным открытым ключом, полученным от Z, и даже не подозревает от проблеме.

Вторая проблема - если пользователь А теряет закрытый ключ, то он должен сообщить своим партнерам, что сообщениям больше нельзя доверять. Но делать это по незащищенному каналу нельзя, потому что иначе Z тоже мог бы представиться А и сказать, что потерял ключ.

Это проблемы уже не криптографии, а "инфраструктуры" - то есть как обеспечить надежную связь пользователя и ключа. Этим занимается PKI.

### Сертификат

Сертификат - это пара "ключ - владелец ключа".