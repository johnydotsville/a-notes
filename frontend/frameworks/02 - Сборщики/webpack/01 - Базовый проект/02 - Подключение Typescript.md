# Добавление Typescript

Сделаем возможность писать программу не на js, а на ts.

P.S. Здесь речь идет о написании именно программы на ts. Это не позволит писать сам конфиг вебпака на ts. Конфиг на ts - это отдельная тема.

# Пакеты

```
npm i -D typescript ts-loader
```

* `typescript` - это компилятор тайпскрипта. Можно установить его отдельно глобально, а можно для каждого конкретного проекта. В данном случае он устанавливается для конкретного проекта.
* `ts-loader` - лоадер нужен, чтобы вебпак смог обработать ts-файлы, потому что изначально он умеет обрабатывать только js.

# tsconfig.json

В одной директории с конфигом вебпака создаем конфиг ts, `tsconfig.json`. Базовый пример:

```yaml
{
  "compilerOptions": {
    "outDir": "./dist/",
    "noImplicitAny": false,
    "module": "es6",
    "target": "es5",
    "allowJs": true,
    "moduleResolution": "node"
  }
}
```

Назначение опций компиляции см в конспекте про язык ts. Вкратце:

* `module` - указываем, какую систему модулей использует среда выполнения, в которой будет крутиться скомпилированная программа. Поскольку у нас средой выполнения в конечном итоге является браузер, то указываем `es6` (она же ES2015) - нативная модульная система в языке JS и браузерах.
* `target` - версия JS, в которую будет скомпилирована программа.
* `outDir` - TODO: не понятно, зачем указывать, если в бандлере уже указано.
* `allowJs` - разрешить использовать в программе js-файлы. Без этого флага нельзя будет ничего импортировать из js-файла в ts-файл.
* `moduleResolution` - 

# Файлы с исходным кодом

* У файлов с исходным кодом изменяем расширение с `.js` на `.ts`

* В файлах, где используется импорт, убираем расширения в строках с импортом. В данном случае, на примере файла index:

  ```typescript
  // import hello from "./utils.ts";  // <-- Здесь надо УБРАТЬ расширение .ts из имени файла.
  import hello from "./utils";
  
  hello();
  ```

# webpack.json

В конфиг вебпака нужно добавить лоадер, чтобы вебпак смог обрабатывать ts-файлы:

```javascript
const path = require('path');

module.exports = {
  mode: 'development',
  entry: './src/index.ts',  // <-- Исходный файл теперь не .js, а .ts
  output: {
    filename: 'main.js',  // <-- Выходной файл остается .js
    path: path.resolve(__dirname, 'dist'),
    clean: true
  },
  module: {
    rules: [
      {  // <-- Добавили лоадер, чтобы вебпак понимал ts-файлы.
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
    ],
  },
  resolve: {  // <-- См TODO
    extensions: [".tsx", ".ts", ".js"]
  }
};
```

TODO: Мутноватая тема с расширениями при импорте в исходном коде. Если расширение не убрать, возникает ошибка `TS5097: An import path can only end with a '.ts' extension when 'allowImportingTsExtensions' is enabled.` В чем там прикол, в двух словах как будто не разобраться. Так что оставил как факультативное на будущее.

TODO: Пока оставляю на уровне "нажми на кнопку, получишь результат". Разобраться во взаимосвязи опций было очень трудно. Назначения опций прочитал, вроде даже понял, но их комбинации какие-то странные. Также плохо понятная взаимосвязь между package.json, конфигом ts и конфигом вебпака. В них некоторые опции дублируются, вроде таргет-директории, но какая используется в итоге и почему нельзя убрать другую - не понятно. Мб потом доразберусь.