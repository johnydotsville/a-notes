# 14 May

Потом почитать разобрать эти вещи, разнести по файлам.

Главная тема:

- [ ] useQuery
  - [ ] Загрузка данных.
    - [ ] ??? Когда начинается? Сразу при выполнении хука?
  - [ ] staleTime
    - [ ] Время устаревания данных.
    - [ ] def 0, данные считаются устаревшими сразу как загрузились.

## useQuery

- [ ] useQuery нужен для загрузки данных. Управляет всей обвязкой, связанной с выполнением запроса.
- [ ] useQuery можно применять много раз в одном и том же компоненте, если надо много разных данных.
- [ ] Параметры хука.
  - [ ] [queryKey](#queryKey) - идентификатор запроса.
  - [ ] [queryFn](#queryFn) - функция загрузки данных.
- [ ] Что возвращает хук.
  - [ ] Возвращает объект, свойства которого - ["артефакты"](#артефакты-useQuery): флаг загрузки, фраг успеха \ неудачи, хранение данных \ ошибки и т.д.
- [ ] Настройки запроса.
  - [ ] useQuery позволяет задать персональные настройки для запроса, переопределив глобальные.
    - [ ] ??? enabled
      - [ ] true* - хук загружает данные сразу при рендере компонента.
      - [ ] false - не загружает.
        - [ ] Можно загрузить вручную артефактом refetch.
- [ ] TODO
  - [ ] ??? Зависимые запросы, Отложенные запросы, Автоматические запросы.
  - [ ] ??? Как страница обновляется автоматически? reactQuery перезапрашивает данные, изменяется состояние и компонент перерисовывается?

## Артефакты useQuery

TODO: флаги

- [ ] ??? TODO
  - [ ] ??? Чем isPending отличается от isLoading (их возвращает useQuery)?

## queryKey

- [ ] queryKey - идентификатор запроса. Благодаря ему RQ различает запросы.
  - [ ] Выполнен как массив для зависимостей-идентификаторов, однозначно позволяющих либе отличить запрос от остальных запросов.
    - [ ] Идентификаторы должны быть легко сериализуемы. Т.е. можно использовать примитивы и объекты, свойства которых - примитивы.
    - [ ] Первый элемент обычно строка, концептуально - "группа" запросов.
      - [ ] Дальше либо примитивы, либо объект объединяющий несколько примитивов. Концептуально - идентификатор запроса внутри группы.

## queryFn

- [ ] queryFn - функция загрузки данных.
  - [ ] Должна быть асинхронной и возвращать промис.
  - [ ] Когда RQ вызывает функцию загрузки данных, он передает ей объект [контекста ctx](#Контекст-RQ).
  - [ ] Передача параметров в queryFn.
    - [ ] Разные способы.
      - [ ] Через контекст.
      - [ ] Лямбда + замыкание.
      - [ ] Комбинация первого и второго.

### Контекст RQ

- [ ] Возможности контекста.
  - [ ] Содержит массив queryKey.
  - [ ] Содержит signal, благодаря которому можно прервать запрос.

