# Основная механика навигации

Базовая навигация между страницами приложения реализуется с помощью таких компонентов:

* `BrowserRouter` 
* `Routes`
* `Link`

Рассмотрим вкратце, какую роль они выполняют.

Важно понимать, что в одностраничных приложениях (SPA) нет реального перехода между страницами, как это бывает в случае с обычными сайтами, когда щелчок по ссылке приводит к обращению к серверу и реальной загрузке другой страницы. В SPA страница всегда одна, поэтому они и называются одностраничными. "Перейти на другую страницу" в SPA фактически означает просто отрисовать другой компонент на той же самой странице.

## BrowserRouter

`BrowserRouter` - это компонент, который служит основой для реализации навигации. Как правило, мы оборачиваем все приложение в BrowserRouter и т.о. он становится контекстом для всех компонентов внутри себя. За счет этого они могут пользоваться такими хуками как useHistory() например.

BrowserRouter отслеживает изменения URL и изменяет свое состояние. За счет этого происходит повторный рендеринг его самого и вложенных в него компонентов. Соответственно компонент `Routes` анализирует обновленный URL и определяет компонент, который с этим URL связан. Этот компонент в итоге реакт и отрисовывает.

## Routes

Компонент `Routes` нужен для того, чтобы определить по текущему URL, какой компонент надо отрисовать. Routes группирует в себе компоненты `Route`, которые содержат информацию, какой URL с каким компонентом связан.

Когда URL изменяется, этот факт отлавливает BrowserRouter и происходит повторный рендеринг. Соответственно, при повторном рендеринге у Routes есть доступ к обновленному URL, так что он проверяет вложенные в себя Route и определяет компонент, который нужно отрисовать.

## Link

Link - это компонент, который используется для организации перехода на другую страницу. Когда происходит щелчок по Link, об этом узнает BrowserRouter и отрисовывает требуемый компонент.

В отличие от тега `<a>`, щелчок по Link не приводит к перезагрузке страницы. Так что для перехода между страницами в пределах приложения обычно используется именно Link.

`<a>` можно использовать, если по каким-то причинам нужно, чтобы страница перезагрузилась, либо если нужно сделать переход куда-то во внешний мир за пределами приложения.

# Навигация и сервер

При использовании BrowserRouter мы должны настроить веб-сервер так, чтобы он на любой запрос возвращал главную страницу приложения. Приложение само определит по URL, какую страницу надо отрисовать. Если такую настройку не сделать, то сервер будет сам пытаться обработать URL и мы будем получать 404 ошибку, потому что в одностраничных приложениях только одна физически реальная страница и у сервера ничего другого просто нет.

В dev-сервер такая настройка выполняется через опцию `historyApiFallback: true`. В конспекте о dev-сервере об этом написано.

# Резюме

Итого, механика навигации работает примерно так:

* Мы щелкаем по Link или обычной ссылке, в результате чего изменяется URL.
* BrowserRouter отлавливает изменение URL всеми возможными способами и это приводит к повторному рендерингу.
* За счет того, что BrowserRouter является контекстом для всех вложенных в него компонентов, Routes имеет актуальное значение URL.
* При повторном рендеринге Routes смотрит на актуальный URL и определяет, какой компонент с этим URL ассоциирован.
* Реакт отрисовывает нужный компонент.