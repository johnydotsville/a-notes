# Лоадеры (loaders)

## Что такое лоадеры

По умолчанию вебпак умеет обрабатывать только `js-` и `json-`файлы. Лоадеры - это дополнения для вебпака, которые позволяют ему обрабатывать и другие файлы, например, ts, css, изображения и другие.

Обработка подразумевает:

* Трансформацию исходного файла в [модуль](https://webpack.js.org/concepts/#loaders), которым сможет воспользоваться приложение. Под трансформацией, вероятно, может пониматься много чего. Пока самый доступный для понимания пример - перевод ts в js.
* Добавление модуля в [граф зависимостей](https://webpack.js.org/concepts/dependency-graph/).

Под *модулем* в вебпаке понимается файл. Когда мы делаем импорт из файла, то файл сперва обрабатывается лоадером.

## Как описать лоадеры

Лоадеры оформляются в виде массива в секции `module.rules` конфига. Каждый лоадер представлен объектом с такими полями:

* `test` - регулярное выражение, с помощью которого вебпак поймет, к каким файлам надо применять указанный лоадер.
* `use` - указываем лоадер, который нужно применять. Это может быть не только единственный лоадер, но и массив лоадеров.
* `exclude` - если файл находится в указанной директории, то его не надо обрабатывать лоадером. Обычно тут указывается директория с установленными пакетами, т.к. они уже находятся в подходящем к использованию состоянии.

```javascript
module.exports = {
  module: {
    rules: [  // <-- Массив правил для обработки файлов различных типов.
      // <-- Каждый тип файла описываем отдельным элементом массива.
      {  // <-- Этот элемент отвечает за ts- и tsx-файлы.
        test: /\.tsx?$/,  // <-- Регулярка, отбирающая файлы, к которым надо применить этот лоадер.
        use: 'ts-loader',  // <-- Указываем, каким лоадером обрабатывать файлы этого типа.
        exclude: /node_modules/,  // <-- Если файл из этой директории, то не надо обрабатывать его лоадером.
      },
      {  // <-- А этот - за css-файлы.
        test: /\.css$/,  // <-- Кавычки НЕ нужны
        use: 'css-loader'
      }
    ],
  }
};
```

> Полезное: сайт https://regex101.com/ для составления и тестирования регулярок.

# Цепочка лоадеров и настройка лоадера

Для лоадера можно задать настройки, а также можно организовать лоадеры в цепочку ([документация](https://webpack.js.org/concepts/loaders/#configuration)). Это может понадобиться, когда преобразование исходного файла происходит в несколько шагов. Например, для файлов стилей, использующих препроцессор, будет цепочка, которая сначала преобразует scss-файл в scss-модуль, потом он преобразуется в css-модуль, а потом style-лоадер вставляет стили в страницу.

* Цепочка лоадеров задается в виде массива.
* Лоадеры из массива выполняются в порядке от последнего элемента к первому, т.е. как бы задом наперед.
* Для лоадера можно задать настройки, используя свойство `options`.

```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [  // <-- Когда нужно несколько лоадеров, оформляем их в массив.
          { loader: 'style-loader' },  // <-- Выполнится третьим.
          {
            loader: 'css-loader',  // <-- Выполнится вторым.
            options: {  // <-- Можно задать для лоадера настройки.
              modules: true,
            },
          },
          { loader: 'sass-loader' },  // <-- Выполнится первым.
        ],
      },
    ],
  },
};
```

