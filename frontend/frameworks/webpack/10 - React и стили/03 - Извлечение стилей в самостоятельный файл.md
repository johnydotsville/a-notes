# Извлечение стилей

Без извлечения стилей в отдельный файл они становятся частью бандла, т.е. находятся непосредственно в js-коде. Извлечение их в отдельный файл имеет такие плюсы:

* Возможность кэшировать файл со стилями.
* Побороть проблему *Flash of Unstyled Content* (`FOUC`), когда страница появляется на короткое время с дефолтными стилями браузера.

TODO: можно потом разобраться подробнее в этой теме.

# Плагин MiniCssExtractPlugin

## Пакеты

| Плагин               | Документация                                                 |
| -------------------- | ------------------------------------------------------------ |
| MiniCssExtractPlugin | [Документация](https://webpack.js.org/plugins/mini-css-extract-plugin/) |

```
npm i -D mini-css-extract-plugin
```

Что делает:

* При сборке проекта оформляет стили в отдельный файл, вместо того, чтобы встраивать их в исходный код бандла. 
* Файл появляется в директории рядом с бандлом и подключается к html.
* Формирует отдельный файл со стилями на каждый js-файл, содержащий стили.

В документации много примеров на разные случаи, на совместное использование с другими лоадерами \ плагинами.

## webpack.config.js

```javascript
import MiniCssExtractPlugin from "mini-css-extract-plugin";  // <-- ES6-стиль.
const MiniCssExtractPlugin = require("mini-css-extract-plugin");  // <-- CommonJS-стиль.
```

Есть базовое правило:

* Не использовать MiniCssExtractPlugin одновременно со style-loader.

style-loader подходит для dev-режима, а для prod - извлечение стилей. Поэтому можно добавить условие в конфиг вебпака, чтобы в каждом режиме использовался нужный подход:

```javascript
const MiniCssExtractPlugin = require("mini-css-extract-plugin");  // <-- Импортируем плагин

module.exports = (settings, argv) => {
  const isDev = argv.mode === "development";
  const isProd = argv.mode === "production";

  // <-- Создаем и настраиваем экземпляр плагина
  const miniCss = new MiniCssExtractPlugin({
    filename: "css/[name].[contenthash:8].entry.css",  // <-- Для файла точки входа.
    chunkFilename: "css/[name].[contenthash:8].css"  // <-- Для остальных файлов.
  });

  return {
    // Остальная часть конфига
    plugins: [
      isProd ? miniCss : false  // <-- Используем miniCss только в проде.
      // Остальные плагины
    ],
    module: {
      rules: [
        // Лоадеры для остальных файлов
        {  // <-- В лоадере для стилей либо style-loader, либо на MiniCssExtractPlugin.loader
          test: /\.s[ac]ss$/i,
          use: [
            isDev ? "style-loader" : MiniCssExtractPlugin.loader,
            "css-loader",
            "sass-loader"
          ]
        },
      ],
    }
  }
};
```

