# Зачем нужен dev-сервер

Dev-сервер упрощает разработку за счет таких вещей как например:

* Автоматический ребилд.
* Перезагрузка страницы при внесении в код изменений.

# Документация

| Документация                                                 | Зачем нужна                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [webpack.js.org](https://webpack.js.org/guides/development/#using-webpack-dev-server) | Дока вебпака по dev-серверу.                                 |
| https://webpack.js.org/configuration/dev-server/             |                                                              |
| [stackoverflow](https://stackoverflow.com/a/47302958/23146485) | Интересный ответ с разными опциями.                          |
| [npmjs.com](https://www.npmjs.com/package/webpack-dev-server) | Дока самого dev-сервера. Например, как использовать его вместе с TS. |

# Установка

Понадобится установить пакет:

```
npm i -D webpack-dev-server
```

# Настройка

## Скрипт запуска

Добавляем в конфиг node-проекта `package.json` скрипт запуска проекта на dev-сервере:

```yaml
{
  # Остальная часть конфига
  "scripts": {
    "build:dev":  "webpack --mode=development",
    "build:prod": "webpack --mode=production",
    "start": "webpack serve --mode=development --env port=3000"  # <-- Скрипт запуска dev-сервера.
  }
}

```

## Конфиг вебпака

Для настройки dev-сервера в конфиге вебпака есть отдельная секция `devServer`:

```javascript
module.exports = (settings, argv) => {
  return {
    // Остальная часть конфига
    devServer: {  // <-- Секция dev-сервера.
      port: settings.port,
      open: true
    }
  }
};
```

TODO: Есть вероятность, что не надо отдельно контролировать "не-создание" dev-сервера, потому что он и так не создается, если режим production. Это не точно, но вероятно так и есть, поэтому пока буду исходить из этого. Если выяснится обратное, поправлю.

# Плагины

Обычно еще требуется html-webpack-plugin для генерации html-страницы и подключения бандла к ней. Здесь я не стал это писать, чтобы не дублировать, так что про подключение этого плагина см. конспект по плагинам ("Встроить бандл в html-страницу").

После установки и настройки этого плагина при старте dev-сервера сгенерированная страница откроется в браузере и можно будет посмотреть как работает программа.

# Опции dev-сервера

## historyApiFallback

```javascript
module.exports = (settings, argv) => {
  return {
    // Остальная часть конфига
    devServer: {
      port: settings.port,
      open: true,
      historyApiFallback: true  // <-- Добавляем опцию для dev-сервера
    }
  }
};
```

Без этой настройки мы не сможем открывать страницы приложения, вводя их в поисковую строку. Переходы будут работать только при щелчке по ссылкам. А с этой настройкой будет работать и так, и так.

Эта настройка заставляет dev-сервер на любой запрос выдавать главную страницу приложения. Т.е. какой бы URL мы ни ввели в адресную строку, сервер всегда вернет "index", а дальше приложение уже разберется, какую страницу надо отрисовать, исходя из URL. Если же этой настройки нет, то сервер сам пытается вернуть результат для этого URL, поэтому получим 404 ошибку.

