# Контекст

Контекст позволяет задать некоторое значение родительскому компоненту и если это значение потребуется где-то в его дочерних компонентов, то они смогут взять его из контекста. Нам не придется прокидывать это значение глубоко через пропсы.

> Контекст не заменяет Redux. Редакс это про управление состоянием, а контекст больше именно про общее пользование какими-то данными в пределах компонента.

# Синтаксис

## Создаем контекст

Можно делать это в отдельном файле. Создаем контекст и устанавливаем значение по умолчанию:

```js
import {createContext} from 'react';

export const UsernameContext = createContext('nousername');  // <-- Создаем контекст
```

## Устанавливаем значение

Импортируем переменную контекста в компоненте, где хотим задать значение для контекста:

```react
import {UsernameContext} from './UsernameContext';  // <-- Импортируем переменную с контекстом

export default function ParentA({username, children}) {
  return (
    <div style={{ backgroundColor: 'aqua' }}>
      <UsernameContext.Provider value={username}>  {/* Задаем через value значение для контекста */}
        {children}
      </UsernameContext.Provider>
    </div>
  );
}
```

Теперь все компоненты, которые находятся внутри `<UsernameContext.Provider>` смогут получить значение из `UsernameContext`.

В одном и том же компоненте можно и пользоваться контекстом, и задавать его:

```react
import {UsernameContext} from './UsernameContext';
import {useContext} from 'react';

export default function ParentB({username, children}) {
  const defaultUsername = useContext(UsernameContext);
  const un = username ?? defaultUsername;
  return (
    <div style={{ backgroundColor: '#FFB7F5' }}>
      <UsernameContext.Provider value={un}>
        {children}
      </UsernameContext.Provider>
    </div>
  );
}
```

Сначала мы извлекаем из контекста значение по умолчанию, которое в него положили при создании. Т.о., если в ParentB не передали значение для контекста, то опять устанавливаем дефолтное.

## Пользуемся значением

Импортируем переменную контекста и функцию для извлечения из него значения:

```react
import {UsernameContext} from './UsernameContext';  // <-- Импортируем переменную контекста
import {useContext} from 'react';  // <-- И функцию для извлечения значения из контекста

export default function Child({title}) {
  const username = useContext(UsernameContext);  // <-- Извлекаем значение из контекста
  return (
    <div>
      <h2>{title}</h2>
      <div>{username ?? 'Контекст не задан'}</div>  {/* <-- Пользуемся значением */}
    </div>
  );
}
```

## Связной компонент

```react
import ParentA from './ParentA';
import ParentB from './ParentB';
import Child from './Child';

export default function ContextDemo() {
  return (
    <>
      <ParentA username='JohNy'>
        <Child title='Этот компонент извлекает username из контекста.' />
        <Child title='А контекст находится в родительском компоненте.' />
        <Child title='Удобно, когда данные нужны на глубоком уровне вложенности.' />
      </ParentA>
      <ParentB username='Sonic'>
        <Child title='Для каждого компонента можно задать свой контекст.' />
        <Child title='Получается контекст один, а значений много.' />
      </ParentB>
      <ParentA>
        <Child title='Здесь контекст не задан и поэтому ничего не будет.' />
      </ParentA>
      <ParentB>
        <Child title='И здесь контекст не задан, но будет значение по умолчанию.' />
      </ParentB>
    </>
  );
}
```

# Советы по контексту

Контекст несколько затрудняет восприятие и снижает читаемость. Поэтому есть несколько советов перед тем, как использовать контекст:

* Сначала попробовать передавать пропсы, даже если их много и они передаются сквозь много компонентов. Возможно, в итоге все будет выглядеть не так уж плохо.
* Внимательнее посмотреть, можно ли извлечь дополнительные компоненты. Бывает так, что компоненты сами не пользуются пропсами, а просто прокидывают их дальше. В этом случае можно просто передавать children или воспользоваться оператором расширения.

Когда контекст хорошо подходит:

* Темы. Если у приложения несколько визуальных тем, есть смысл положить текущую тему в контекст, а в компонентах получать значение темы и на основе этого корректировать их внешний вид.
* Текущий пользователь.
* Управление состоянием, которое требуется по всему приложению и находится почти у самого верха.