# Создание проекта

webpack-проект это обычный node-проект, в который установлены нужные пакеты. Поэтому для начала просто создаем пустой node-проект в любой директории:

```
npm init -y
```

В ней появится файл конфига node-проекта, `package.json`

Добавим директорию `src`, и в нее два файла, чтобы было что собирать:

```javascript
// Файл index.js
import hello from "./utils.js";

hello();
```

```javascript
// Файл utils.js
function hello() {
  console.log("Hello, webpack and typescript!");
}

export default hello;
```



# Пакеты вебпака

Для начала работы с вебпаком требуется два пакета:

```
npm i webpack webpack-cli -D
```

- `webpack` - это основная зависимость, собственно сам вебпак.
- `webpack-cli` - это модуль для работы с вебпаком через консоль.
- `-D` - это ключ, указывающий на то что эти зависимости нам нужны только для разработки нашей программы. Когда наша программа будет выполняться, эти зависимости ей уже не пригодятся. Подробнее про типы зависимостей и ключи - в конспекте про пакеты в nodejs.

# Файл конфигурации вебпака

Файл конфигурации вебпака:

* Называется `webpack.config.js` 
  * Конфиг можно писать не только на js, но и на typescript. Тогда название файла должно быть с расширением `.ts`
* Класть конфиг нужно в корневую директорию проекта.

Пример базового конфига:

```javascript
const path = require('path');

module.exports = {
  mode: 'development',
  entry: './src/index.js',
  output: {
    filename: 'main.js',
    path: path.resolve(__dirname, 'dist'),
    clean: true
  },
};
```

Про структуру конфига подробнее в отдельном конспекте. Вкратце:

* `mode` - режим сборки. Может быть `development` или `production`. Влияет на то, какие оптимизации \ шаги вебпак будет выполнять при сборке проекта.
* `entry` - главный файл приложения, "точка входа".
* `output` - настройки результата сборки.
  * `filename` - имя для файла, который получится в результате сборки.
  * `path` - директория, в которую нужно положить результирующий файл.
    * `__dirname` - node-константа. Ссылается на директорию, в которой лежит текущий файл.
  * `clean: true` - указывает, что нужно очищать целевую директорию перед каждой сборкой.

# Скрипты

## Написание скриптов

Для сборки вебпак-проекта нужно написать скрипты в конфиге самого node-проекта (файл `package.json`), в секции `scripts`. Пример самого базового скрипта:

```yaml
{
  "name": "mywebpack",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {  # <-- Секция скриптов
    "build": "webpack"  # <-- Самый простой скрипт сборки с помощью вебпака
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "webpack": "^5.93.0",
    "webpack-cli": "^5.1.4"
  }
}
```

## Запуск скриптов

Запускаются скрипты консольной командой `npm run имяСкрипта` из директории с конфигом, например:

```
npm run build
```

## Имя скрипта

Можно давать скриптам более специализированные имена для наглядности, например `build:dev`, `build:prod` и т.д. Полезное, когда есть несколько скриптов сборки с разными параметрами:

```yaml
{
  "name": "mywebpack",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {  # <-- Секция скриптов
    "build:dev": "webpack --mode=development",  # <-- Скрипт для сборки в dev-режиме
    "build:prod": "webpack --mode=production"   # <-- Скрипт для сборки в prod-режиме
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "webpack": "^5.93.0",
    "webpack-cli": "^5.1.4"
  }
}
```

# Добавление Typescript

Сделаем возможность писать программу не на js, а на ts.

P.S. Здесь речь идет о написании именно программы на ts. Это не позволит писать сам конфиг вебпака на ts, это отдельная тема.

## Пакеты

```
npm i -D typescript ts-loader
```

* `typescript` - это компилятор тайпскрипта. Можно установить его отдельно глобально, а можно для каждого конкретного проекта. В данном случае он устанавливается для конкретного проекта.
* `ts-loader` - лоадер нужен, чтобы вебпак смог обработать ts-файлы, потому что изначально он умеет обрабатывать только js.

## tsconfig.json

В одной директории с конфигом вебпака создаем конфиг ts, `tsconfig.json`. Базовый пример:

```yaml
{
  "compilerOptions": {
    "outDir": "./dist/",
    "noImplicitAny": false,
    "module": "es6",
    "target": "es5",
    "allowJs": true,
    "moduleResolution": "node"
  }
}
```

Назначение опций компиляции см в конспекте про язык ts. Вкратце:

* `module` - указываем, какую систему модулей использует среда выполнения, в которой будет крутиться скомпилированная программа. Поскольку у нас средой выполнения в конечном итоге является браузер, то указываем `es6` (она же ES2015) - нативная модульная система в языке JS и браузерах.
* `target` - версия JS, в которую будет скомпилирована программа.
* `outDir` - TODO: не понятно, зачем указывать, если в бандлере уже указано.
* `allowJs` - разрешить использовать в программе js-файлы. Без этого флага нельзя будет ничего импортировать из js-файла в ts-файл.
* `moduleResolution` - 

## Файлы с исходным кодом

* У файлов с исходным кодом изменяем расширение с `.js` на `.ts`

* В файлах, где используется импорт, убираем расширения в строках с импортом. В данном случае, на примере файла index:

  ```typescript
  // import hello from "./utils.ts";  // <-- Здесь надо УБРАТЬ расширение .ts из имени файла.
  import hello from "./utils";
  
  hello();
  ```

## webpack.json

В конфиг вебпака нужно добавить лоадер, чтобы вебпак смог обрабатывать ts-файлы:

```javascript
const path = require('path');

module.exports = {
  mode: 'development',
  entry: './src/index.ts',  // <-- Исходный файл теперь не .js, а .ts
  output: {
    filename: 'main.js',  // <-- Выходной файл остается .js
    path: path.resolve(__dirname, 'dist'),
    clean: true
  },
  module: {
    rules: [
      {  // <-- Добавили лоадер, чтобы вебпак понимал ts-файлы.
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
    ],
  },
  resolve: {  // <-- См TODO
    extensions: [".tsx", ".ts", ".js"]
  }
};
```

TODO: Мутноватая тема с расширениями при импорте в исходном коде. Если расширение не убрать, возникает ошибка `TS5097: An import path can only end with a '.ts' extension when 'allowImportingTsExtensions' is enabled.` В чем там прикол, в двух словах как будто не разобраться. Так что оставил как факультативное на будущее.

TODO: Пока оставляю на уровне "нажми на кнопку, получишь результат". Разобраться во взаимосвязи опций было очень трудно. Назначения опций прочитал, вроде даже понял, но их комбинации какие-то странные. Также плохо понятная взаимосвязь между package.json, конфигом ts и конфигом вебпака. В них некоторые опции дублируются, вроде таргет-директории, но какая используется в итоге и почему нельзя убрать другую - не понятно. Мб потом доразберусь.