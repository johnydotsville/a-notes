# Открытие и создание БД

## Метод .open()

БД создается и открывается одним и тем же методом - `.open()`. У него два параметра:

* Имя БД.
* Версия БД.

Метод возвращает `запрос` на создание \ открытие БД. У запроса три события (мб больше, но пока опишу только актуальные для себя):

* `onupgradeneeded` - срабатывает в двух случаях:
  * Когда БД еще не существует.
  * Когда в open указана версия старше, чем текущая версия БД.
* `onsuccess` - срабатывает, когда БД открылась успешно.
* `onerror` - срабатывает, когда при открытии БД произошла ошибка.

`onupgradeneeded` и `onsuccess` срабатывают последовательно. Например, если БД не существует или версия увеличилась, то сначала сработает onupgradeneeded, а потом onsuccess.

## Получение объекта БД, свойство .result

Саму БД можно получить из запроса через свойство `.result`:

```javascript
new Promise((resolve, reject) => {
  const request = indexedDB.open("localdb", 5);  // <-- Делаем запрос на открытие.

  request.onupgradeneeded = (event) => {
    console.log("БД еще не существует, либо версия увеличилась.");
    const db = request.result;  // <-- Получаем объект БД из запроса.
  }

  request.onsuccess = (event) => {
    console.log("БД открыта успешно!");
    const db = request.result;  // <-- Получаем объект БД из запроса.
    resolve(db);
  }

  request.onerror = (event) => {
    console.log("Ошибка при открытии БД: " + request.error);
    reject(request.error);  // <-- Получаем ошибку из запроса.
  }
});
```

Что делать с БД после успешного открытия - наше дело. Можно например сразу создать хранилища, а можно вернуть объект БД из промиса.