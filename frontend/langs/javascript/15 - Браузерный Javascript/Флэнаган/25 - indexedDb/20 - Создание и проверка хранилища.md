# Создать хранилище

## Метод .createObjectStore()

Важно! Создавать хранилище можно только при открытии БД в событии `onupgradeneeded`. Иначе будет ошибка:

```
Failed to execute 'createObjectStore' on 'IDBDatabase': The database is not running a version change transaction
```

Хранилище создается методом `.createObjectStore()` на объекте БД ([документация](https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/createObjectStore)):

```javascript
function createStorage(database) {
  const name = "users";  // <-- Имя для хранилища.
  const options = {  // <-- Опции для хранилища, связанные с ключами.
    // keyPath: "id",
    // autoIncrement: true
  };
  database.createObjectStore(name, options);  // <-- Создаем хранилище в БД.
}
```

## Параметры метода .createObjectStore()

У метода два параметра:

* Имя хранилища.

* Опции для хранилища. Эти опции связаны с ключом, поскольку у каждого объекта, который мы добавляем в хранилище, должен быть ключ. Этот параметр не обязательный, но тогда придется указывать ключ вручную.

  * `keyPath` - позволяет указать поле объекта, которое нужно использовать в качестве ключа.
  * `autoIncrement` - если true, тогда хранилище будет использовать генератор ключей и при сохранении объект получит очередной ключ автоматически. Сам генератор тоже создается автоматически.

  Можно разом использовать обе опции. Тогда работать будет так: если у объекта есть поле, указанное в keyPath, то оно возьмется в качестве ключа. Если поля нет, тогда будет использован генератор. Примеры, показывающие влияние этих опций на сохранение объета, будут ниже.

## Примеры работы опций хранилища

Примеры с демонстрацией, как будет выглядеть добавление объекта в хранилище при разных способах создания хранилища.

### autoIncrement: true

Предоставляем хранилищу возможность автоматически установить ключ для объекта:

```javascript
function save(database) {
  const data = {
    firstname: "Tom",
    lastname: "Sawyer"
  };

  const storageName = "users";
  const tx = database.transaction(storageName, "readwrite");
  const storage = tx.objectStore(storageName);
  storage.add(data);  // <-- Просто сохраняем объект, ключ он получит автоматически.
}
```

### keyPath: "поле"

Ситуация, когда мы указали в настройках хранилища, какое поле сохраняемого объекта следует использовать в качестве ключа:

```javascript
function save(database) {
  const data = {
    id: 10,  // <-- В keyPath при создании хранилища мы указывали id
    firstname: "Tom",
    lastname: "Sawyer"
  };

  const storageName = "users";
  const tx = database.transaction(storageName, "readwrite");
  const storage = tx.objectStore(storageName);
  storage.add(data);  // <-- В качестве ключа будет взято значение 10, из поля id объекта data.
}
```

### Нет опций

Когда нет опций, то нужно вручную указать ключ для объекта:

```javascript
function save(database) {
  const data = {
    firstname: "Tom",
    lastname: "Sawyer"
  };

  const storageName = "users";
  const tx = database.transaction(storageName, "readwrite");
  const storage = tx.objectStore(storageName);
  storage.add(data, 100);  // <-- При сохранении указываем ключ самостоятельно.
}
```

# Проверка существования хранилища

Проверить, существует ли хранилище, можно так:

```javascript
if (!database.objectStoreNames.contains(name)) {
  // Если хранилище с таким именем не существует
}
```

Если попытаться создать хранилище, которое уже существует, будет ошибка:

```
Failed to execute 'createObjectStore' on 'IDBDatabase': An object store with the specified name already exists
```

