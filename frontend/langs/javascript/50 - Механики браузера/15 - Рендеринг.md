# Рендеринг

Рендеринг - это процесс, состоящий из нескольких этапов:

1. `Style calculation` (пересчёт стилей)
2. `Layout` (расчёт геометрии элементов)
3. `Paint` (отрисовка в bitmap)
4. `Composite` (слоистое наложение + вывод на экран)

Часть этой работы (начальные этапы) выполняется в главном потоке, а часть - в отдельных. Какие именно где - отдельная тема, не суть важно, главное понять, что часть рендеринга выполняется в главном потоке со всеми остальными задачами и они могут эти этапы рендеринга задержать, если выполняются долго.

Суть рендеринга - преобразование DOM и стилей в реальные пиксели на экране.

Браузер пытается выполнять рендер с частотой 60 кадров в секунду. Это значит, что рендер должен выполняться примерно каждые 16.6 мс. Но поскольку часть вычислений, которые нужны для рендера, выполняются в главном потоке, то если в нем запускается тяжелая задача (например, мы написали обработчик для кнопки, в котором крутится долгий цикл, имитируя тяжелую работу), которая запустилась и выполняется дольше этих 16.6 мс, тогда браузер не может выполнить рендер, пока тяжелая задача не завершится. Соответственно, "новый" кадр отсутствует, браузер отображает вместо него старый и из-за этого складывается впечатление, что страница тормозит.

У микрозадач абсолютный приоритет. Пока очередь микрозадач не пуста, они выполняются, а рендер - нет. Поэтому, если в микротаске рекурсивно создавать микротаски, то до рендера дело не дойдет вообще. Когда все микрозадачи выполнились, тогда идет проверка - пришло ли время делать рендер?

* Если не пришло, тогда браузер выполняет одну макрозадачу.
* Если оказалось, что время рендера пришло и "просрочено", тогда браузер может пойти двумя путями - если просрочилось чуть-чуть, тогда выполняется рендер. Если просрочилось сильно, тогда рендер пропускается и выполняется макрозадача.

Затем итерация Event Loop'а повторяется.

