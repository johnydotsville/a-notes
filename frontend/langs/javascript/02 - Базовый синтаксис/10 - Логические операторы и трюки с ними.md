# Логические операторы

| Оператор     | Значение                                                  |
| ------------ | --------------------------------------------------------- |
| `||`, `||=`  | Или, присваивающее или                                    |
| `&&`,  `&&=` | И, присваивающее и                                        |
| `!`,  `!!`   | Не, Двойное не                                            |
| `??`,  `??=` | Оператор нулевого слияния, оператор нулевого присваивания |



## ИЛИ и И

Обычные правила:

* Операторы пытаются привести операнды к логическому типу для выполнения сравнения.

* Вычисление выражений идет слева направо.

* Приоритет И выше, чем у ИЛИ. Т.е. сначала вычисляются все И, а потом начинают вычисляться ИЛИ.

* "Сокращенное вычисление".

  * ИЛИ идет до первого истинного выражения.

    ```javascript
    true  || alert("Никогда не сработает.");
    false || alert("Сработает всегда.");
    ```

  * И идет до первого ложного выражения.

Хитрые правила:

* ИЛИ *возвращает* первое истинное выражение, а если все выражения оказались ложными, то просто возвращает последнее. Примеры:

  ```javascript
  alert(0 || true || 1 || "foobar");  // Выведет true, как первое истиное выражение.
  alert(0 || "" || false);  // Выведет false, т.к. тут все ложь, а false - последняя ложь.
  ```

  ```javascript
  let firstname = "";
  let lastname = "";
  let nickname = "Johnny C"
  
  let user = firstname || lastname || nickname || "Аноним";  // в user будет строка "Johnny C"
  ```

  Здесь первым истинным выражением оказалось nickname, поэтому оператор || вернул его.

* И *возвращает* первое *ложное* выражение, а если все выражения оказались истинными, то возвращает последнее. Пример:

  ```javascript
  alert(true && "foobar" && 0 && 1);  // Выведет 0, как первое ложное значение.
  alert(true && 1 && "foobar");  // Выведет foobar, т.к. тут все истина, а foobar - последнее.
  ```

Традиционное использование, например, в условиях:

```javascript
let isWeekend = true;
let hour = 15;

if (hour < 9 || hour > 18 || isWeekend) {
  alert("Офис закрыт.")
}
```

## Присваивающие ИЛИ и И

### Присваивающее ИЛИ

Присваивающее ИЛИ `||=` выполняет присваивание, если левый операнд является ложным.

Рассмотрим такой пример:

```javascript
let manufacturer = "";
if (manufacturer === "") {
    manufacturer = "Не указан";
}
```

С помощью присваивающего ИЛИ можно записать его вот так:

```javascript
let manufacturer = "Xiaomi";
manufacturer ||= "Не указан."  // В manufacturer осталось "Xiaomi"
```

```javascript
let manufacturer = "";
manufacturer ||= "Не указан."  // В manufacturer стало "Не указан"
```

В первом случае в manufacturer была не пустая строка, поэтому ИЛИ дало true, стало быть присваивание нового значения не произошло. Во втором случае в переменной была пустая строка, следовательно ИЛИ дало false и выполнилось присваивание.

Этот оператор удобно использовать вместо написания if. Однако он является новым и не всеми браузерами пока поддерживается.

### Присваивающее И

Присваивающее И `&&=` выполняет присваивание, если операнд является истинным.

Этот оператор используется реже, чем `||=`, но вот довольно искусственный пример просто для демонстрации:

```javascript
let greeting = "Привет";
let user = "Alice";
greeting &&= greeting + ", " + user;  // "Привет, Alice".
```

```javascript
let greeting = "";
let user = "Alice";
greeting &&= greeting + ", " + user;  // "", осталась пустая строка.
```

В первом случае в greeting уже было значение, поэтому `&&=` дало true и присвоение состоялось. Во втором случае переменная содержала пустую строку, `&&=` дало false и переменная осталась как была.

TODO: дописать сюда хорошие примеры, если попадутся.

## НЕ и Двойное Не

Оператор НЕ `!` приводит операнд к логическому типу и инвертирует его. Оператор двойного не `!!` просто приводит операнд к логическому типу (аналог по сути `Boolean(a)`). Например:

```javascript
let a = true;
a = !a;  // Теперь a false

let b = "hello";
let c = !b;    // false, привел "hello" к логическому true и инвертировал.
let d = !!b;   // true, просто привел "hello" к логическому true и оставил как есть.
let e = !!!b;  // false
```

## Нулевое слияние

Оператор `??` возвращает левый операнд, если он не `null \ undefined`, иначе возвращает правый. Пример:

```java
let username = "Alice";
alert(username ?? "Аноним");  // Выведет Alice
```

```javascript
let username;
alert(username ?? "Аноним");  // Выведет Аноним
```

Этот оператор аналог такой конструкции:

```javascript
result = a ?? b;
result = (a !== null && a !== undefined) ? a : b;
```

У него довольно низкий приоритет (3), поэтому часто используется со скобками.

### Отличие от ||

Отличие заключается в том, что `??` срабатывает только на null \ undefined. А `||` не отличает null \ undefined от 0, false, "".

Иначе говоря:

* `??` возвращает первое *определенное* значение.
* `||` возвращает первое *истинное* значение.

Примеры:

```javascript
let height = 0;
let defaultHeight = 100;

let h1 = height || defaultHeight;  // h1 стало 100.
let h2 = height ?? defaultHeight;  // h2 стало 0.
```

В данном примере height имеет вполне нормальное значение 0. Это не значит, что высота не определена, она именно равняется нулю. Однако || меняет ее, что является неподходящим поведением.

### Совместное использование с || и &&

В одном выражении использовать `??` с `||` и `&&` можно только если отделять их явно скобками:

```javascript
let a = 1 && 2 ?? 3;    // Ошибка синтакса.
let b = (1 && 2) ?? 3;  // Ок.
```

## Нулевое присваивание

Оператор `??=` позволяет проверить переменную на null \ undefined и в этом случае присвоить ей заданное значение. Пример:

```javascript
let username;  // undefined
username ??= "Аноним";  // username стало "Аноним", т.к. было undefined
```

```javascript
let username = "Alice";
username ??= "Аноним";  // username осталось "Alice"
```

# Упражнения

```javascript
alert( null || 2 || undefined );
```

Ответ: 2. Первое истинное.

```javascript
alert( alert(1) || 2 || alert(3) );
```

Ответ: 1, 2. Вызов alert возвращает undefined. Так что первый alert выполнится и вернет undefined. Поскольку || расценит этот undefined как ложь, то пойдет проверять дальше, второе выражение, 2. Поскольку оно - истина, то 2 оператор не будет проверять дальше, вернет эту двойку, которая попадет во внешний alert.

```javascript
alert( 1 && null && 2 );
```

Ответ: null. Первое ложное.

```javascript
alert( alert(1) && alert(2) );
```

Ответ: 1, undefined. Выполнится alert, поэтому 1. Это выполнение вернет undefined, которое расценивается как ложь и поэтому оператор && вернет его во внешний alert.

```javascript
alert( null || 2 && 3 || 4 );
```

Ответ: 3. Сначала выполнится && т.к. она приоритетнее. 2 и 3 оба истина, поэтому вернется 3 и общее выражение примет вид `null || 3 || 4`. Или вернет первую истину, т.е. 3.

```javascript
let value = NaN;

value &&= 10;  // NaN это false, поэтому не срабатывает.
value ||= 20;  // value осталось NaN, т.е. false, поэтому сработает и станет 20.
value &&= 30;  // 20 это true, поэтому сработает и станет 30.
value ||= 40;  // 30 это true, поэтому не сработает.

alert(value);  // 30
```

Ответ: 30.

```javascript
// Какие alert выполнятся и что какое выражение операторы вернут в каждом if?
if (-1 || 0) alert( 'first' );
if (-1 && 0) alert( 'second' );
if (null || -1 && 1) alert( 'third' );
```

Ответ: первый выполнится, вернет -1. Второй *не* выполнится, вернет 0. Третий выполнится, вернет 1.