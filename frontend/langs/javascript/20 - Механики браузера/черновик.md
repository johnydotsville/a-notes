**Асинхронные скрипты (async/defer)**:

- `async` — выполняется как макротаска сразу после загрузки
- `defer` — выполняется как макротаска после парсинга HTML

### Что происходит "до" Event Loop?

На самом деле ничего — Event Loop запускается сразу при открытии  документа. Даже самый первый скрипт выполняется в его контексте.





```
Правильно ли я понимаю, что в браузере "построить DOM" это не то же самое что "рендер"? Правильно ли я понимаю, что постройка DOM это просто создание какой-то программной структуры, вроде дерева, а рендер - это уже процесс отрисовки реальных пикселей в окне, чтобы это дерево как бы визуализировать?
```

Угадал.

---

```
Правильно ли я понимаю, что defer скрипты начинают выполяться, только когда DOM полностью готов?
```

Да. В порядке, в котором встретились.



# Самоконтроль

- Зачем я это делаю?
  - Интересно разобраться, как происходит начальное формирование страницы.

# Что удалось выяснить +- достоверно



* [x] 

* [x] Рендер страницы - это преобразование DOM в реальные пиксели на экране. Соответственно, пока DOM не построен, то рендер не может начаться.

* [x] 

  







# Сомнительные вещи

- [ ] Когда страница загружается и происходит парсинг HTML, то если встречается inline-скрипт, парсинг приостанавливается и скрипт выполняется синхронно.
  - [ ] А если это не inline скрипт? async \ defer



# Event Loop

- [x] Очереди задач реализованы как часть браузера, т.е. эти очереди относятся к памяти браузера, а не памяти "нашей программы". На каждую вкладку свои очереди.
- [x] Когда происходит событие, вроде наведения мыши на элемент, то это событие само по себе не является микро- или макро-таской, это просто системное событие, которое браузер отлавливает. А вот если на это событие мы повесим обработчик, тогда уже браузер кладет этот обработчик в очередь макротасок.
- [x] Event Loop создается сразу при открытии вкладки браузера и начинает сразу же работать.
- [x] Пока в очередях есть задачи, луп извлекает их и выполняет. Как только очереди пустеют, луп вызывает метод ОС, и поток блокируется. Т.о. луп переходит в коматозное состояние, а когда в очереди появляется задач, ОС пробуждает поток и луп снова начинает обрабатывать очереди.

❌ Event Loop, хотя является "бесконечным" циклом, на деле не работает постоянно. Браузер умеет его приостанавливать, когда очереди задач пусты и работы как бы нет. Тогда браузер его усыпляет, и будит, когда поступает новая задача.

❌ Event Loop создается сразу при открытии вкладки браузера и начинает сразу же работать. Работает он с помощью механизмов ОС. Пока в очередях есть задачи, луп работает "активно" - сам проверяет очереди на наличие задач. Если очереди опустели и задач долго нет, то луп переходит в "idle"-режим и прекращает опрашивать очереди самостоятельно. Теперь когда в очереди появятся задачи, ему об этом сообщит ОС и он снова перейдет в активный режим. Т.о. не "браузер усыпляет" и "пробуждает" луп, а просто меняется механизм проверки очередей.



