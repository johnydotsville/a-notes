# Тип symbol

## Зачем нужны

Символы в js не имеют отношения к "отдельным буквам". Символ это специальный тип данных, который удобно использовать для реализации идентификаторов.

## Как создать

```javascript
let id1 = Symbol();  // Символ без "имени"
let id2 = Symbol("Любая строка");  // Символ с "именем"
```

```javascript
id2.description;  // Получить доступ к "имени"
```

Каждый символ - уникален:

```javascript
let id1 = Symbol("id");  // С виду одинаковые, но на деле - разные
let id2 = Symbol("id");

console.log(id1 == id2);   // false
console.log(id1 === id2);  // false
```

## Преобразование символов

Символы явно не преобразуются в строки. Для этого нужно явно вызвать метод `.toString()` на символе:

```javascript
let id = Symbol("id");
alert(id);  // TypeError: Cannot convert a Symbol value to a string
alert(id.toString());  // Ok, Symbol(id)
```

## Особенности поведения

С символами связано несколько механик:

* Цикл `for in` игнорирует символьные свойства.
* `Object.assign` копирует символьные свойства так же, как и обычные.

## Применение

С помощью символа мы можем создать уникальный идентификатор для объекта:

* Создаем символ:

  ```javascript
  let ids = Symbol("Идентификатор");
  ```

* Добавляем его к объекту. Квадратными скобками мы пользуется, чтобы именем поля стало именно *значение* символа, которое гарантированно уникально для каждого символа. Поэтому мы получаем гарантию уникальности имени поля по всей программе.

  * Вариант 1: при литеральном создании объекта:

    ```javascript
    let user = {
      name: "Tom",
      [ids]: 1100  // <-- Пользуемся квадратными скобками
    };
    
    console.log(user[ids]);  // 1100
    ```

  * Вариант 2: добавляем к уже существующему объекту:

    ```javascript
    let user = {
      name: "Tom"
    };
    
    user[ids] = 2200;
    console.log(user[ids]);  // 2200
    ```

  * Вариант 3: в конструкторе: P.S. Придумал сам, возможно так не делают.

    ```javascript
    let ids = Symbol("Идентификатор");
    
    function User(name, id) {
      this.name = name;
      this[ids] = id;
    }
    
    let user = new User("Tom", 3300);
    
    console.log(user[ids]);  // 3300
    ```

### Символьный и строковый идентификатор

Небольшой комментарий относительно их отличия. Строковые имена объектов могут привести к путанице. Допустим, где-то в скрипте, кто-то объявил свойство через обычную строку:

```javascript
...
user.id = 1100;
// или так:
user["id"] = 1100;
...
```

Если мы теперь напишем `user.id = 2200`, то по сути перезапишем значение. Мы даже можем не подозревать, что кто-то где-то добавил объекту такое свойство. P.S. Я пока не знаю как выглядят крупные программы, в которых множество скриптов, но суть, насколько я понял, в том что за счет гибкости js мы можем или библиотеки могут случайно поменять таким образом свойства, что приведет к ошибкам.

Когда же мы создаем символ, то по сути получаем какое-то уникальное в пределах программы значение, которое подставляется в качестве имени поля и за счет этого исключается возможность случайной перезаписи. Грубо говоря:

```javascript
let ids = Symbol();  // Грубо говоря, генерируется какое-то sdaf48sad4f5sadfasd

let user = {
  name: "Tom",
  sdaf48sad4f5sadfasd: 1100  // Грубо говоря, получается такое имя свойства
}

console.log(user[ids]);  // Грубо говоря, получается user["sdaf48sad4f5sadfasd"])
```

За счет этого достигается уникальность.

## Глобальные символы

Если мы хотим использовать один и тот же символ повторно, например, в разных функциях, то нам потребуется как-то сохранить символ, а потом извлечь. Для этого существует т.н. *глобальный реестр символов*.

Команды для работы с реестром:

* `Symbol.for("имя")` - если символ с указанным именем существует в реестре, то извлекает его. Если не существует - то создает.

* `Symbol.keyFor(sym)` - принимает переменную с символом и возвращает из реестра его имя. Если такого символа в реестре нет, возвращает undefined.

  В целом, когда есть сам символ, проще получить его имя через свойство `description`.

Пример:

```javascript
let ids = Symbol.for("id");  // <-- Создаем новый символ под именем "id" в реестре

let user = {
  name: "Tom",
  [ids]: 1100
};

let product = {
  title: "apple",
  [ids]: 3311
};

let sid = Symbol.for("id");  // <-- Извлекаем символ из реестра, пользуясь "именем"

console.log(user[sid]);     // 1100
console.log(product[sid]);  // 3311

let sn = Symbol.keyFor(sid);  // <-- По самому символу пытаемся получить его имя
console.log(sn);  // id
```

