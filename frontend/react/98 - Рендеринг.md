# UI-дерево

В реакте UI представлен в виде дерева компонентов (буду дальше называть UI-дерево), которое впоследствии превращается непосредственно в конечный UI. Конечный UI состоит из примитивов рендеринга, характерных для конкретной платформы. Например, для веб это HTML-теги, для андроид - его собственные примитивы и т.д. Эти конкретные примитивы не являются частью реакта, т.о. реакт является платформенно-независимым UI-фреймворком. Превращением UI-дерево в интерфейс конечной платформы занимаются отдельные библиотеки.

# Рендеринг

## Общая механика

Когда приложение запускается впервые, то происходит **начальная отрисовка** - все компоненты отрисовываются полностью с нуля и формируют DOM (буду писать DOM, на примере браузера, для простоты). К этому моменту у нас есть UI-дерево и DOM.

Когда у какого-то компонента меняется состояние, то в UI-дереве он помечается как требующий перерисовки. Реакт обходит UI-дерево с корня (этот обход называется **рендеринг**), обнаруживает такие компоненты, вызывает функцию компонента и получает его актуальную версию (этот вызов функции компонента можно назвать **рендеринг компонента**).

Когда обход завершен и у реакта есть актуальная версия всего интерфейса, он делает **комит** в DOM. Сделать комит означает перерисовать части реального интерфейса, чтобы они соответствовали актуальным версиям компонентов, которые за эти части интерфейса отвечают.

Итого, формирование конечного интерфейса включает два шага:

* Рендеринг.
* Комит в DOM. Например, в браузере это применение браузерных методов по модификации DOM-дерева, вроде appendChild и прочих, после которых браузер перерисует *реальные элементы*.

## Особенности

* Если родительский компонент помечен как требующий перерисовки, то будут вызваны функции и дочерних компонентов тоже. Т.е. если нужно перерисовать компонент, то также нужно перерисовать и все его дочерние компоненты.
* Если в результате рендеринга реакт поймет, что фактически никаких изменений в компоненте не произошло, то он не будет менять DOM. Т.е. тот факт, что какой-то компонент отрендерился заново, не означает, что будет изменена соответствующая часть DOM. Однако ресурсы все равно будут затрачены на вызов функции компонента и попытку понять, произошли ли в нем изменения.

## Хуки

Хуки доступны только на этапе рендеринга. Их можно вызывать исключительно на верхнем уровне компонента (нельзя вызвать хук, например, в обработчике события нажатия на кнопку).