# Куки

В основном взято [отсюда](https://developer.mozilla.org/ru/docs/Web/HTTP/Cookies)

## Что такое куки

Куки - это данные (обычно небольшое количество) вспомогательного характера, которые передаются между браузером и сервером. 

## Как куки создаются

Впервые кука создается в браузере. В общих чертах процесс возникновения куки выглядит так:

* Браузер посылает на сервер какой-то запрос

* Сервер возвращает ответ, в котором, среди прочих заголовков, может присутствовать заголовок *Set-Cookie* (или несколько таких заголовков, если надо создать несколько кук). Куки-заголовки в ответе выглядят примерно так:

  ```java
  Set-Cookie: key1=value1; expires=Mon, 17-Jul-2017 16:06:00 GMT; Max-Age=31449600; Path=/; secure
  Set-Cookie: key2="value2"; Max-Age=31449600; Path=/; secure; SameSite=Strict; HttpOnly
  ```

* Видя заголовок Set-cookie в ответе, браузер понимает, что надо создать куку

* Он ее создает и хранит у себя, и отправляет на сервер в заголовке *Cookie* с каждым очередным запросом. Кука отправляется только на тот сервер, который приказал браузеру создать ее. Если кук несколько, все они идут через `;` в одном заголовке. Пример запроса с куки-заголовком, который клиент посылает на сервер:

  ```java
  GET /spec.html HTTP/1.1
  Host: www.example.com
  Cookie: foo=10; bar=20  // <-- Вот они, несколько кук в одном заголовке
  Accept: */*
  ```

## Доступность кук

Куки доступны из JS через document.cookies. Но не все, а только установленные браузером для домена, с которого получена текущая страница. Т.е. на "странице" невозможно получить куки "другого сайта".

## Формат кук

Вот пример заголовка, содержащего куки:

```
Set-Cookie: key1=value1; expires=Mon, 17-Jul-2017 16:06:00 GMT; Max-Age=31449600; Path=/; secure
Set-Cookie: key2="value2"; Max-Age=31449600; Path=/; secure; SameSite=Strict; HttpOnly
```

Куки хранятся в формате ключ-значение, причем значение может быть заключено в кавычки, если надо. После этого идут дополнительные параметры куки - например:

* Max-Age или expires - время жизни куки
* HttpOnly - запрет получать значение куки через Javascript
* sercure - возможность отправлять куку только через Https с использованием SSL

 Параметров довольно много, это отдельная тема.

## Время жизни кук

По времени жизни куки делятся на два вида:

* Permanent cookie ("со сроком годности") - существуют заранее определенный промежуток времени, в течение которого браузер продолжает их хранить и отправлять, а по истечении этого промежутка - удаляет.

  Браузер создает такие куки, когда сервер присылает куку с заголовком *Expires* или *Max-Age*. В первом случае указывается дата и время, по какое существует кука. Во втором - количество секунд.

* Session cookie - существуют и отправляются, пока идет активный обмен между браузером и сервером. Когда активный обмен заканчивается (например, закрыли браузер), такие куки удаляются. Но в браузерах обычно есть опция "восстановления сеанса", при которой куки не удаляются и сеанс длится как бы бесконечно.