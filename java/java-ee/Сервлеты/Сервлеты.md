* Деплоить будем на Tomcat
* Создадим простой сервлет



# Сервлеты и контейнеры сервлетов

*Сервлет* - это Java-класс, в который мы можем поместить логику обработки Http-запроса. Если мы затем предоставим этот класс *контейнеру сервлетов*, то когда прийдет подходящий запрос, контейнер вызовет наш сервлет для его обработки.

Одним из самых популярных контейнеров сервлетов является Tomcat.

Что такое контейнер сервлетов? Немного дополнительной информации: есть так называемая Java EE (которая в данный момент переименована в Jakarta EE). Это "спецификация серверной платформы" - набор API, которым должна обладать гипотетическая реализация, чтобы построить супер-пупер-крутое-и-сложное веб-приложение. В эту спецификацию входят много других спецификаций, например, транзакции, валидация, хранение и остальные непонятные технологии (см. википедию). Примером конкретной реализации Java EE является Glassfish - это *сервер приложений* (application server). Т.е. предполагается, что сервер приложений реализует все спецификации.

Среди этой кучи спецификаций, составляющих сервер приложений, есть *спецификация сервлетов* - компонентов, предназначенных для обработки http-запросов. Так вот *контейнером сервлетов* называется программа, которая реализует только спецификацию сервлетов. Грубо говоря, контейнер сервлетов - это "сервер приложений на минималках".



# Tomcat

Для установки Tomcat нужно просто скачать zip-архив и распаковать его в удобное место.

Для запуска\остановки открываем консоль, переходим в tomcat/bin и вызываем *startup\shutdown*.

После успешного запуска на localhost:8080/ должна быть страница приветствия.

Чтобы развернуть приложение, достаточно положить war в папку *tomcat\webapps*. Останавливать его не надо - он автоматически видит изменения. После этого приложение становится доступно по адресу

```
localhost:8080/appname
```

Т.е. если файл приложения называется servlet-1.war, то оно будет доступно по адресу localhost:8080/servlet-1

Если вдруг что-то пошло не так, логи можно посмотреть в папке tomcat\logs, файлы называются catalina.2022-05-18.txt по дате логирования.

# Простой сервлет

Используем maven проект. Для компиляции нам понадобится зависимость, содержащая классы сервлетов. Но поскольку мы будем деплоить на Tomcat, который в своем составе имеет эту зависимость, то скоуп поставим provided:

```xml
<dependency>
      <groupId>jakarta.platform</groupId>
      <artifactId>jakarta.jakartaee-api</artifactId>
      <version>8.0.0</version>
      <scope>provided</scope>
</dependency>
```

Можно использовать старую зависимость:

```xml
<dependency>
    <groupId>javax</groupId>
    <artifactId>javaee-api</artifactId>
    <version>7.0</version>
    <scope>provided</scope>
</dependency>
```

Чтобы развернуть программу на Tomcat, мы должны упаковать ее в war. Для этого в pom рядом с описанием проекта добавим вид упаковки war с помощью тега <packaging>:

```xml
<groupId>johny.dotsville</groupId>
<artifactId>servlet</artifactId>
<version>1</version>
<packaging>war</packaging>
```

и подключим плагин, который собственно и занимается упаковкой (если уже есть другой плагин для упаковки, надо его убрать):

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-war-plugin</artifactId>
    <version>3.3.2</version>
    <configuration>
    	<failOnMissingWebXml>false</failOnMissingWebXml>
        <outputDirectory>C:/tmp</outputDirectory>  <!-- Если хотим в какое-то свое место класть архив -->
    </configuration>
</plugin>
```

Создадим в папке main папку resources, а в ней папку *webapp* - она хранит статические ресурсы. Положим в нее простой файл index.html:

```html
<strong>Hello, servlet!</strong>
```

Создадим вот такой класс сервлета (создание и настройку логгера смотри в отдельном мануале):

```java
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

import org.apache.logging.log4j.Logger;
import org.apache.logging.log4j.LogManager;

@WebServlet(name = "NoMatter", urlPatterns = { "/test" })
public class SimpleServlet extends HttpServlet {
    private static final Logger logger = LogManager.getLogger();
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        logger.info("Выполняем метод doGet");
        resp.getWriter().println("GET: Servlet works");
    }
}
```

Собственно все. Благодаря аннотации @WebServlet томкэт сможет обнаружить наш сервлет и использовать его для обработки GET-запросов, приходящих по адресу localhost:8080/servlet-1/test