# Микросервисная архитектура

Микросервисная архитектура во многом вдохновлена DDD-подходом. В частности, идея ограниченного контекста (bounded context) из DDD широко используется в мс. Ограниченный контекст - это способ объединения компонентов системы прежде всего по *логическому* признаку, а не по техническому.

Допустим, мы выделили для будущей системы такие понятия как "Товар", "Покупатель \ Клиент", "Заказ". Для каждого понятия выделяем важные с точки зрения бизнеса характеристики, например:

* Покупатель
  * ФИО
  * Адрес
  * Статус, зависящий от потраченных на товары деньги и от процента выкупа товаров.
* Товар
  * Категория
  * Цена
  * Производитель
* Заказ
  * Покупатель, сделавший заказ
  * Набор товаров в заказе
  * Срочность сборки заказа

Кроме того нам известно, что у компании есть своя служба комплектации, доставки, отдел продаж и т.д.

## Монолитный подход

Для монолитных систем характерна группировка компонентов преимущественно по техническому признаку: это значит, что мы, например, выделяем уровень бизнес-логики и все компоненты, относящиеся к бизнес-логике, помещаем в этот уровень. Например, перечисленные выше понятия со всеми своими характеристиками попадают в виде классов на уровень бизнес-логики. Компоненты на одном уровне спокойно могут взаимодействовать друг с другом, за счет чего достигается высокая степень переиспользования кода и, как следствие, низкая степень его дублирования. Недостатком становится сильная связанность компонентов, когда невозможно взять несколько компонентов и, например, оформить в виде отдельной подсистемы или переписать их так, чтобы это не повлияло на другие компоненты.

## Микросервисный подход

В противовес (или в дополнение, это как посмотреть) такому подходу мы можем сгруппировать компоненты не только по техническому признаку, но и по логическому, или, говоря иначе, "выделить домен". Домен - это логически самостоятельная, самодостаточная группа компонентов. При выделении домена мы можем думать о компонентах с позиции того, кто и как ими будет пользоваться. TODO: Возможно это как раз не домен, а ограниченный контекст.

Например, с точки зрения службы доставки, такая характеристика "Заказа" как срочность сборки абсолютно не важна, потому что курьеру для выполнения его работы достаточно просто знать адрес и, пусть, имя получателя. Курьеру даже не обязательно знать состав заказа, его задачей может быть просто доставить коробку, а если покупатель обнаружит какое-то несоответствие, то отвезти коробку обратно. А вот службе комплектации наоборот, может быть совершенно не важно, кому и куда поедет заказ, зато набор товаров и срочность сборки, очевидно, максимально важна.

Таким образом, у нас образовалось два домена, и в каждом фигурирует компонент "Заказ", но с разными характеристиками. Что мы делаем? Мы в каждом домене создаем свой компонент "Заказ", снабжая его только теми характеристиками, которые важны этому домену. В итоге у нас на уровне бизнес-логики образуется как минимум два компонента "Заказ", а может быть и больше. В этом случае у нас обратная монолитному подходу ситуация - связанность компонентов становится меньше, а дублирования кода - больше.

TODO: надо вписать потом, что становится с компонентами, которые не принадлежат доменам (если такое бывает), но выполняют операции над всеми видами "Заказов" (если это, опять же, бывает).

# Размер и границы сервисов

Мс являются распределенной архитектурой: каждый сервис запускается на отдельном сервере \ виртуальной машине. Ключевая вещь в мс - оптимально определить степень разбиения. Мс не означают буквально "крошечные" программы. Если сервисы окажутся слишком маленькими, то много времени будет уходить на сетевые вызовы, которые очевидно работают медленнее, чем обычные вызовы методов. К тому же требуется проверять права доступа при прохождении запроса от сервиса к сервису.

В идеале каждый мс должен быть максимально самостоятельным, целиком реализовывать какую-то часть системы без необходимости дергать другие сервисы. Если какие-то сервисы чересчур активно взаимодействуют, это называется communication overhead и вероятно лучшим решением станет их объединение в один сервис, т.к. не рекомендуется увлекаться транзакциями, проходящими через несколько сервисов.

# Изоляция данных

Мс предполагают изоляцию данных. Это означает, что нет какой-то общей БД - у каждого мс она своя.



# Буфер





# TODO

* Читал про какой-то вариант "распределенного монолита". Это когда ты думаешь, что у тебя микросервисы, а на самом деле - разбитый монолит, криво склеенный запросами.
* Получше разобраться в терминах "ограниченный контекст" и "домен".


