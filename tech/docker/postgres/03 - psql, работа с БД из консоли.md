# Варианты запуска psql

* Можно в pgAdmin через ПКМ на нужной БД выбрать PSQL Tool.
* Можно через виндовую консоль перейти в директорию утилит и оттуда запустить psql например так  `psql -U postgres`. Больше опций подключения см в разделе "Подключение к БД".


# Официальная документация

Официальная документация по утилите находится [здесь](https://www.postgresql.org/docs/9.4/app-psql.html).

# Команды

Команды из этого раздела можно назвать системными, они не связаны непосредственно с манипуляцией данными. Их можно вводить без `;` в конце.

## Подключение к БД

```
psql -d demo -U postgres -h localhost -p 5432
```

* `-d` - имя БД, к которой мы подключаемся. Если имя БД не указывать, она будет такая же, как имя пользователя.
* `-U` - пользователь, под которым мы подключаемся.
* `-h` - сервер, на котором крутится СУБД.
* `-p` - порт сервера, который слушает СУБД. По умолчанию 5432.

Ключи h и p можно не использовать, когда работа идет локально.

## Состав БД

Для получения информации о том, какие например таблицы есть в БД, существует несколько команд:

* `dt` - список таблиц.
* `dv` - список представлений.
* `di` - список индексов.
* `df` - список функций.

Если нужна информация по конкретному элементу БД, существует команда:

* `\d tableName` - вместо tableName может быть имя представления, индекса и т.д.

## Полезные

* `\q` - выйти из утилиты psql.
* `\! cls` - очистить консоль.





# SQL и консоль

## Справка

`\h` показывает список sql-команд, для которых доступна справка. Указание конкретной команды, например `\h create table` выведет справку по этой команде. В данном случае по созданию таблицы.

Некоторые справки занимают несколько страниц. Перемещаться по ним можно так:

* `Enter` - показать следующую строку.
* `Space` - показать следующую страницу.
* `Ctrl + C` - закрыть справку. 

## Форматирование

### Расширенный режим отображения данных

По умолчанию выбранные данные выводятся в таком виде:

```
 ticket_no   | book_ref | passenger_id |   passenger_name   |
-------------+----------+--------------+--------------------+
005432000987 | 06B046   | 8149 604011  | VALERIY TIKHONOV   |
005432000988 | 06B046   | 8499 420203  | EVGENIYA ALEKSEEVA |
005432000989 | E170C3   | 1011 752484  | ARTUR GERASIMOV    |
```

Если они не влезут в ширину окна, то все расползется и станет нечитаемым. Поэтому существует альтернативный формат вывода (expanded display):

```
-[ RECORD 1 ]--+-------------------------
ticket_no      | 0005432000987
book_ref       | 06B046
passenger_id   | 8149 604011
passenger_name | VALERIY TIKHONOV
-[ RECORD 2 ]--+-------------------------
ticket_no      | 0005432000988
book_ref       | 06B046
passenger_id   | 8499 420203
passenger_name | EVGENIYA ALEKSEEVA
```

* `\x` - включить режим expanded display. Повторный вызов включает \ отключает режим.
* `\x auto`  - теоретически, должен автоматически распознавать, когда режим нужен, а когда нет. На деле как-то не очень заработало.

### Отображение null

По умолчанию null отображается пустотой. Можно задать любое представление:

```
\pset null null
```

Теперь null будет отображаться строкой null. Можно было бы поставить noval или вроде того, в общем, любой удобный символ.

## Выполнение SQL-команды

Все sql-команды в консоли должны заканчиваться `;` это признак завершения команды. Без этого нажатие на Enter просто сделает перевод на следующую строку и любой введенный текст будет трактоваться как продолжение команды.

Чтобы выполнить SQL-команду в psql, достаточно просто набрать ее и нажать Enter. Это подходит для простых коротких команд. Если команда длинная, то удобнее написать ее в текстовом редакторе и затем выполнить из psql. Для этого есть два способа:

* `\e` - открывает текстовый редактор, заданный в системе по умолчанию. Здесь можно ввести запрос, сохраниться и после закрытия редактора psql выполнит этот запрос. Каждый вызов этой команды открывает один и тот же автоматически созданный файл и каждый раз он перезаписывается.
* `\i C:/tmp/filename.sql` - выполнить запрос из указанного файла.



# TODO

Потом раскидать эти команды по нужным разделам

## 1

```
\di boo*.*
```

Вывести индексы всех таблиц, которые находятся в схеме, начинающейся на boo 