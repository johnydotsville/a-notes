# Подключение к серверу из pgAdmin

Запустим pgAdmin и подключимся к серверу, который у нас крутится в контейнере. В зависимости от версии pgAdmin, настройка нового подключения может осуществляться через разные меню, например:

```
ПКМ по Servers > Create > Server
ПКМ по Servers > Register > Server
```

В общем, ищем нужное меню и используем в качестве настроек подключения те, которые использовали при поднятии контейнера. Например, если поднимали контейнер такой командой:

```
docker run --name pgs -p 5432:5432 -e POSTGRES_PASSWORD=j123 postgres
```

То настройки будут такие (почему именно такие имя БД и пользователь - см в конспекте по разворачиванию контейнера):

```
Name: pgs (можно любое имя, оно служит для косметических целей)
Host Name / address: localhost
Port: 5432 (это порт хоста, мы его прокинули на такой же порт контейнера с постгрёй)
Maintenance database: postgres
Username: postgres
Password: j123
```

Соединение pgs создается с использованием указанного пользователя (postgres), так что когда мы работаем через это соединение, то всегда от этого пользователя. "Сменить" его нельзя.

# Утилиты pgAdmin

pgAdmin устанавливается с несколькими утилитами в составе, например:

* `psql` - позволяет работать с СУБД из консоли.
* `pg_restore` - позволяет восстановить БД из архива.

В зависимости от версии pgAdmin они могут располагаться в разных директориях, например:

```
C:\Program Files\PostgreSQL\14\bin
C:\Users\JohNy\AppData\Local\Programs\pgAdmin 4\v7\runtime
```

Нужно указать pgAdmin'у путь до директории с утилитами (если они не указаны автоматически). Заходим в `File > Preferences > Paths > Binary Paths` и проверяем в разделе `PostgreSQL Binary Path > PostgreSQL 14 \ 15` путь до bin. Если директория до утилит не указана, то указываем.

# Заполнение данными

В качестве данных можно найти базу dvdrental, а еще у postgrespro есть демо-база с полетами самолетов. И там, и там предоставляется sql с созданием схемы БД и заполнением ее данными.

Для работы понадобится утилита `psql (устанавливается автоматически с pgAdmin).

## Аренда DVD

Эту БД удалось восстановить только через pgAdmin:

* Создаем через pgAdmin БД dvdrental.
* ПКМ на ней, *Restore*. Если не работает, значит не указали путь до утилит, см раздел "Утилиты pgAdmin".
* Указываем архивный файл *.tar* Не директорию, не файл restore, а именно целый архив .tar Возможно что по умолчанию в окне выбора файла будет выставлен фильтр на sql и tar-файл не будет видно. Снимаем этот фильтр и выбираем tar.
* БД разворачивается, жмем на ней ПКМ > Refresh и появляются таблицы с данными.

## Полеты

Эту БД удалось нормально создать через консоль:

* Открываем виндовую консоль, переходим в директорию с утилитой psql.
* Подключаемся к консоли пострги под дефолтным пользователем (это postgres): `psql -U postgres` (важно не ставить в конце этой команды точку с запятой). Хотя мы подключимся так к БД с названием postgres, это не важно, это не помешает нам создать новую БД.
* Вводим мастер-пароль, попадаем в консоль постгри.
* Вводим `\i 'C:/path/to/script.sql'` до скрипта создания БД полетов, слэши обязательно такие `/`. Точка с запятой в конце команды не нужна, путь должен быть простой, без пробелов и кириллицы.
* После того как скрипт отработает и снова появится приглашение консоли, в pgAdmin обновляем раздел Databases и там появится база *demo*.
* Разворачиваем ее, далее *Schemas > bookings > Tables*, убеждаемся, что появились таблицы с данными.

# psql в контейнере

Сверху рассматривался случай, когда psql находилась на локальном компьютере. Кроме того, в контейнере с постгрёй тоже есть psql. Поэтому, если взаимодействие с какими-то локальными вещами (например, скрипт восстановления БД) не нужны, то можно запускать psql прямо в контейнере.

Для этого нужно отправить докеру команду:

```
docker exec -it pgs psql -U postgres
```

* `pgs` - имя контейнера.
* `postgres` - имя пользователя.
* `-d` - имя БД, если не задано, то такое же как имя пользователя.

