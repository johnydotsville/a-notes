# Поднимаем Postgres в контейнере

## Скачиваем образ

Скачиваем последний образ постгри. Можно скачать и другие образы, список [здесь](https://hub.docker.com/_/postgres/tags):

```
docker pull postgres:latest
```

Проверим, что образ скачался. Отобразим все скаченные образы:

```
docker images
```

В списке должен быть образ с именем postgres.

## Справка по настройке контейнера

Если нужна сразу готовая команда, можно перейти к следующему разделу.

Официальная документация по настройке [здесь](https://hub.docker.com/_/postgres).

При разворачивании контейнера в нем создается БД и пользователь. Можно влиять на этот процесс путем задания переменных окружения контейнера. Многие из них устанавливаются по умолчанию, обязательной является только мастер-пароль. 

Минимальная команда подъема контейнера, пригодного для использования, выглядит так:

```
docker run --name pgs -p 5432:5432 -e POSTGRES_PASSWORD=j123 postgres
```

Про синтаксис команды `run`, ключи `--name` и `-e` написано в основном конспекте докера. Вкратце: run используется для первичного запуска контейнера из образа. Здесь postgres - имя образа, из которого разворачивается контейнер. Через --name указывается имя будущего контейнера. Через -e задаем переменные окружения.

Доступные переменные окружения (список не полный, см. официальную доку):

* `POSTGRES_PASSWORD` - обязательная, задает мастер-пароль.
* `POSTGRES_USER` - задает имя дефолтного пользователя. Он обладает правами суперпользователя. По умолчанию имеет значение postgres.
  P.S. Некоторые вещи могут быть заточены под дефолтное имя. Например, у меня не получилось развернуть базу dvdrental, потому что там используется имя postgres. Соединение с сервером у меня было создано с именем johny, я добавил в список имя postgres, пробовал менять в самих файлах бекапа имя пользователя, но все равно не заработало. Так что менять юзера с дефолтного на какого-то еще - на свой страх и риск.
* `POSTGRES_DB` - задает имя БД, которая создастся в контейнере. Если эту переменную не задать явно, то имя БД будет такое же, как имя пользователя.

## Разворачиваем контейнер

На данный момент минимально адекватная команда для меня выглядит так:

```
docker run --name pgs -p 5432:5432 -e POSTGRES_PASSWORD=j123 postgres
```

Создастся контейнер с именем pgs, внутри него будет БД с именем postgres и пользователь тоже называется postgres.