# Идея Volume (тома)

Volume'ы это способ сберечь данные после удаления контейнера. Это еще можно сделать с помощью монтирования *директории хоста* к директории внутри контейнера, но тома являются предпочтительным способом, потому что они не зависят от файловой системы хоста напрямую, т.к. полностью управляются докером. И по разным другим причинам, о которых можно погуглить, если интересно.

Основная идея в том, что после монтирования тома к какой-либо директории контейнера, все что сохраняется в эту директорию, автоматически попадает и в том. А поскольку том является самостоятельной сущностью и от контейнера не зависит, то после уничтожения контейнера, информация в томе остается и мы можем приделать его к новому\другому контейнеру и пользоваться данными.

# Операции с томами

## Список томов

```
docker volume ls  // Список томов
```

## Создать том

```
docker volume create myvol  // myvol - имя, придуманное нами для тома
```

## Удалить том

```
docker volume rm myvol
```

## Информация о томе

```
docker volume inspect myvol
```

## Примонтировать том

Проще всего это делается при запуске контейнера (`\` позволяет размещать длинную команду на нескольких строках для лучшей читаемости):

```
docker run \
--name postgres_standalone -e POSTGRES_PASSWORD=j123 -p 5432:5432 \
--mount source="myvol",destination="/var/lib/postgresql/data" \
postgres
```

* `--mount` опция, здесь в *source* указываем имя тома, а в *destination* - директорию контейнера, к которой нужно примонтировать том.

После запуска контейнера, командой `docker inspect container-name` можно посмотреть, все ли нормально примонтировалось, в разделе *Mounts*:

```json
 "Mounts": [
     {
         "Type": "volume",
         "Name": "postgres_data",
         "Source": "/var/lib/docker/volumes/postgres_data/_data",
         "Destination": "/var/lib/postgresql/data",
         "Driver": "local",
         "Mode": "z",
         "RW": true,
         "Propagation": ""
    }
]
```

Несколько фактов:

* Если указать несуществующий том, он будет создан автоматически.
* Примонтированный при первом запуске том остается привязанным к контейнеру и при выполнении docker start уже не надо указывать том явно.

# Тома и docker compose

```yaml
version: "3.3"

services:
  
...
        
  db:
    image: postgres
    ...
    volumes:
      - pgs_data:/var/lib/postgresql/data
    ...

volumes:
  pgs_data:
    # external: true
...

```

Тома описываются в отдельной секции volumes. Если опции не нужны, то просто оставляем пустую строку.

Используемый том и директория, к которой он должен монтироваться, указываются среди прочих параметров сервиса. Директория указывается без кавычек.

## Опции томов

* `external: true` - указывает, что том должен быть создан заранее. Без этой опции том будет создан при первом запуске компоста и переиспользоваться при последующих.



