# Материалы

* https://kubernetes.io/docs/concepts/overview/components/
* 



Кубер - это оркестратор контейнеров. Его задача - управлять множеством контейнеров, которые запущены на *разных* машинах (физических или виртуальных).

# Архитектура kubernetes

Логически, систему кубера можно разделить на несколько компонентов.

![k8s-architecture](img/k8s-architecture.png)

## Node

Нода - это, грубо говоря, компонент, в котором крутится контейнер. Каждая нода - это отдельная физическая или виртуальная машина. Несколько нод формируют кластер.

В состав ноды входят несколько компонентов:

* container runtime interface - это система, в которой крутится Pod. По сути, этой системой является Docker.
  * Pod - это вместилище контейнера. Внутри пода уже непосредственно крутится docker-контейнер. В одном поде мб несколько контейнеров, но как правило там один. Несколько их бывает только в случаях, когда "основному" контейнеру (нашему приложению) требуется что-то дополнительное.
* kubelet - это компонент, который связывает ноду с Control plane. Он, вероятно, вытягивает из нее спецификации подов, запускает их и контролирует, что они работают нормально.
* kube-proxy - компонент, который организует связь ноды с внутренним или внешним (по отношению к кластеру) сетевым трафиком.



## Control plane

Занимает отдельную машину в кластере. Является мозгом кластера, отслеживает события, происходящие в нем и реагирует на них. Выполняет разные задачи, которые распределены между несколькими компонентами:

* kube-apiserver - точка взаимодействия с панелью управления. Выставляет api для работы с кластером. Может масштабироваться горизонтально.
* etcd - хранилище типа "ключ-значение", в котором кубер хранит все данные о кластере.
* kube-scheduler - наблюдает за новыми созданными подами и решает, в какую ноду определить под.
* kube-controller-manager - этот компонент наблюдает за состоянием кластера через apiserver и следит за тем, чтобы текущее состояние совпадало с желаемым. Например, желаемое состояние - чтобы крутилось три экземпляра микросервиса. Если один вдруг упал, то текущее состояние не соответствует желаемому и задача контроллера в данном случае - поднять еще один экземпляр. Под "контроллером" понимается цикл (control loop), который занимается наблюдением за каким-то одним фактором. Несколько таких контроллеров объединены в единый процесс.
* cloud-controller-manager - компонент для выполнения логики, связанной с облачным провайдером. Может отсутствовать, например если кубер запущен на локальном компьютере в учебных целях.

Технически, эти компоненты могут располагаться на разных машинах кластера, но как правило находятся на одном.