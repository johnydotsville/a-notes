# Коммиты

Не забываем, что в коммит попадает только то, что мы положили в стейдж.

## Обычный коммит

* С коротким сообщением:

  ```
  git commit -m "Если сообщение короткое, можно ввести его через ключ -m"
  ```

* С длинным сообщением (откроется vi для ввода текста сообщения):

  ```
  git commit
  ```

  Краткая справка: когда vi откроется, нажимаем `i` (раскладка должна быть английская, иначе не поймет), чтобы перейти в режим ввода текста. Вводим текст сообщения к коммиту, можно многострочный, через Enter как в обычном блокноте. Когда ввели все, что хотели, нажимаем `Esc`, чтобы перейти в режим команд, набираем `:wq` (write-and-quit), жмем `Enter`, и происходит коммит.

## Коммит с автостейджем

Обычно перед тем как закоммитить изменения, мы с помощью `git add` помещаем файлы в стейдж. Это позволяет нам точечно выбрать конкретные файлы для коммита. Однако с помощью флага `-a` мы можем автоматически поместить *все отслеживаемые* файлы в стейдж при коммите:

```
git commit -a -m "Можно руками не вызывать git add, а использовать флаг -a при коммите"
```

Особое внимание на фразу *все отслеживаемые* файлы. Т.е. если мы добавим в рабочую директорию новый файл и выполним `git commit -a`, то этот файл не закоммитится, потому что он еще не отслеживаемый и придется сначала руками его добавить через `git add`. А вот если мы внесем изменения в какой-нибудь старый, уже известный гиту файл, тогда эти изменения закоммитятся.

## Частичный коммит

Пользуемся для этого дефолтным графическим интерфейсом:

* Выделяем фрагмент, который хотим закоммитить (нужно выделять как добавленные строки, так и удаленные).
* *ПКМ > Stage Lines For Commit* чтобы добавить выделенное в стейдж (чтобы удалить потом это из стейджа, см конспект по стейджу).

<img src="img/partial-commit-lines.png" alt="partial-commit-lines"  />

В данном случае мы видим, что в файл *добавлены* две строки комментариев, *удалена* строка с печатью "Hello, git", а вместо нее оставлена пустая. Допустим мы хотим выполнить частичный коммит и закоммитить только удаление строки. Поэтому мы выделяем изменения как показано в правой части скрина и выбираем для коммита только их. После выполнения коммита можно убедиться, что комментарии в него не попали.

## --amend

amend переводится как "вносить исправления". С его помощью можно удобно подправить последний коммит, но это относится только к локальным коммитам, которые еще не запушены. Я не буду вставлять скрины и расписывать, что будет если амендить запушенные, но я проверил и убедился, что если вдруг уже запушил и выяснилось, что что-то забыл, то амендить уже поздно, надо делать просто новый коммит.

Механически, при аменде получается новый коммит, который "выталкивает в помойку" последний коммит и встает вместо него.

### Прибавить код к последнему коммиту

1. Кладем изменения в стейдж.

2. Добавляем изменения к ласт коммиту:

   * Не меняя сообщение коммита:

     ```
     git commit --amend --no-edit
     ```

   * Заменяя сообщение коммита на новое:

     * Сообщение короткое:

       ```
       git commit --amend -m "Если хотим изменить сообщение и оно короткое"
       ```

     * Если сообщение длинное, то введем его через vi:

       ```
       git commit --amend
       ```

### Изменить сообщение к последнему коммиту

```
// НЕ добавляем никаких файлов в стейдж!
git commit --amend -m "Новое сообщение заменит старое"
git commit --amend  // Если хотим редактировать сообщение в vi
```

## Объединить коммиты

Делается через интерактивный rebase, см. раздел про ребейз

## Откатиться на указанный коммит с удалением изменений

Все, что было *после* указанного коммита - исчезнет (cb42b1650 - начальная часть id коммита):

```
git reset cb42b1650 --hard
```



